<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Planner</title>
  <link rel="stylesheet" href="/css/budget.css">
</head>

<body>
  <header class="navbar">
    <nav>
      <h1>Budget Planner</h1>
      <a href="/" class="nav-home">Back to Home</a>
    </nav>
  </header>

  <% 
    const safeSummary = (typeof summary !== 'undefined' && summary) 
      ? summary 
      : { totalIncome: 0, totalExpense: 0, balance: 0 };
  %>

  <main class="budget-container">
    <!-- Income form -->
    <section>
      <h2>Add Income</h2>
      <form action="/transactions" method="POST">
        <input type="number" step="0.01" name="amount" required>
        <input type="hidden" name="type" value="income">

        <select name="category_id">
          <% if (typeof categories !== 'undefined' && categories && categories.length) { %>
            <% categories.forEach(c => { if (c.type === 'income') { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% } }) %>
          <% } else { %>
            <option disabled>No income categories yet</option>
          <% } %>
        </select>

        <button type="submit">Add Income</button>
      </form>
    </section>

    <!-- Expense Section -->
    <section class="expense-section">
      <h2>Expenses</h2>
      <div class="expense-inputs">
        <input type="number" id="expense-amount" placeholder="Amount">
        <select id="expense-type">
          <option value="Entertainment">Entertainment</option>
          <option value="Food">Food</option>
          <option value="Investments">Investments</option>
          <option value="Rent">Rent</option>
          <option value="Savings">Savings</option>
          <option value="Transportation">Transportation</option>
          <option value="Utilities">Utilities</option>
          <option value="Other">Other</option>
    <!-- Expense form -->
    <section>
      <h2>Add Expense</h2>
      <form action="/transactions" method="POST">
        <input type="number" step="0.01" name="amount" required>

        <select name="category_id" required>
          <% if (typeof categories !== 'undefined' && categories && categories.length) { %>
            <% categories.forEach(c => { if (c.type === 'expense') { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% } }) %>
          <% } else { %>
            <option disabled>No expense categories yet</option>
          <% } %>
        </select>

        <input type="hidden" name="type" value="expense">
        <button type="submit">Add Expense</button>
      </form>

      <h3>Recent Expenses</h3>
      <ul>
        <% if (typeof transactions !== 'undefined' && transactions && transactions.length) { %>
          <% transactions.forEach(t => { if (t.type === 'expense') { %>
            <li>$<%= t.amount %> â€“ <%= t.category_name || 'Uncategorized' %></li>
          <% } }) %>
        <% } else { %>
          <li>No expenses yet</li>
        <% } %>
      </ul>
    </section>

    <!-- Summary -->
    <section>
      <h2>Summary</h2>
      <p>Total Income: $<%= safeSummary.totalIncome %></p>
      <p>Total Expenses: $<%= safeSummary.totalExpense %></p>
      <p>Balance: $<%= safeSummary.balance %></p>
    </section>
    
  </main>

  <!-- <script src="/js/budget.js"></script> -->
</body>
</html>
