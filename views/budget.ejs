<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Planner</title>
  <link rel="stylesheet" href="/css/budget.css">
</head>

<body>
  <header class="navbar">
    <nav>
      <h1>Budget Planner</h1>
      <a href="/" class="nav-home">Back to Home</a>
    </nav>
  </header>

  <% 
    const safeSummary = (typeof summary !== 'undefined' && summary) 
      ? summary 
      : { totalIncome: 0, totalExpense: 0, balance: 0 };
  %>

  <main class="budget-container">
    <!-- Income form -->
    <section>
      <h2>Add Income</h2>
      <form action="/transactions" method="POST">
        <input type="number" step="0.01" name="amount" required>
        <input type="hidden" name="type" value="income">

        <select name="category_id">
          <% if (typeof categories !== 'undefined' && categories && categories.length) { %>
            <% categories.forEach(c => { if (c.type === 'income') { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% } }) %>
          <% } else { %>
            <option disabled>No income categories yet</option>
          <% } %>
        </select>

        <button type="submit">Add Income</button>
      </form>
      <ul>
        <% if (typeof transactions !== 'undefined' && transactions && transactions.length) { %>
          <% transactions.forEach(t => { if (t.type === 'income') { %>
            <li>
              $<%= t.amount %> – <%= t.category_name || 'Uncategorized' %>
      
              <!-- Edit link, we load a new form with the transaction data to edit it -->
              <a href="/transactions/<%= t.id %>/edit">edit</a>
      
              <!-- Delete form -->
              <form action="/transactions/<%= t.id %>/delete" method="POST" style="display:inline">
                <button type="submit">delete</button>
              </form>
            </li>
          <% } }) %>
        <% } else { %>
          <li>No income yet</li>
        <% } %>
      </ul>
    </section>

    <!-- Expense Section -->
    <section class="expense-section">
      <h2>Expenses</h2>
    <!-- Expense form -->
    <section>
      <h2>Add Expense</h2>
      <form action="/transactions" method="POST">
        <input type="number" step="0.01" name="amount" required>

        <select name="category_id" required>
          <% if (typeof categories !== 'undefined' && categories && categories.length) { %>
            <% categories.forEach(c => { if (c.type === 'expense') { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% } }) %>
          <% } else { %>
            <option disabled>No expense categories yet</option>
          <% } %>
        </select>

        <input type="hidden" name="type" value="expense">
        <button type="submit">Add Expense</button>
        <input type="hidden" name="type" value="expense">
        <button type="submit">Delete Expense</button>
      </form>

      <h3>Recent Expenses</h3>
      <ul>
        <% if (typeof transactions !== 'undefined' && transactions && transactions.length) { %>
          <% transactions.forEach(t => { if (t.type === 'expense') { %>
            <li>
              $<%= t.amount %> – <%= t.category_name || 'Uncategorized' %>
              <!-- Similar to income, we provide edit and delete options to meet CRUD req -->
              <a href="/transactions/<%= t.id %>/edit">edit</a>
              <form action="/transactions/<%= t.id %>/delete" method="POST" style="display:inline">
                <button type="submit">delete</button>
              </form>
            </li>
          <% } }) %>
        <% } else { %>
          <li>No expenses yet</li>
        <% } %>
      </ul>
    </section>

    <!-- Summary -->
    <section>
      <h2>Summary</h2>
      <p>Total Income: $<%= safeSummary.totalIncome %></p>
      <p>Total Expenses: $<%= safeSummary.totalExpense %></p>
      <p>Balance: $<%= safeSummary.balance %></p>
    </section>
    
  </main>

  <!-- <script src="/js/budget.js"></script> -->
</body>
</html>
